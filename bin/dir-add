#!/bin/sh

set -eu

cd "$(dirname "$0")/.."

LIB="lib"

command="$1"
name="${2:-common}"
line="alias ${command}=\"sudo ${command}\""
if file="$(grep -R -l "${line}" "${LIB}")"; then
  >&2 echo "${command}: already in: ${file}"
  exit 1
fi

tmp="$(mktemp)"
{ cat "${LIB}/${name}.sh"; echo "${line}"; } | sort -u > "${tmp}"
mv "${tmp}" "${LIB}/${name}.sh"

git add .
git commit -a -m "${0}${command:+: ${command}}"
git push

